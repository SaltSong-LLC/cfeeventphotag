<!-- ============================================ -->
<!--                 Navigation                   -->
<!-- ============================================ -->

{% set logo = "/assets/images/logo.png" %}
{% set logo_alt = "CFE Event Photographers" %}

<header id="page-header">
    <div class="container">
        <div class="top">
            <nav class="navbar" aria-label="main navigation">
                <button class="toggle" aria-label="mobile menu toggle" aria-expanded="false" aria-controls="cs-ul-wrapper" aria-haspopup="menu">
                    <span class="box" aria-hidden="true">
                        <span class="line line1"></span>
                        <span class="line line2"></span>
                        <span class="line line3"></span>
                    </span>
                </button>
                <div class="ul-wrapper">
                    <ul class="menu-list">
                        {% set navPages = collections.all | eleventyNavigation %}

                        {# Loop through all pages with a eleventyNavigation in the frontmatter #}
                        {% for entry in navPages %}

                            {# Define a hasChild variable to make it easier to test what navigation items are have child dropdown pages #}
                            {% set hasChild = entry.children.length %}
                            {% set isActive = entry.url == page.url %}

                            {# Check the frontmatter for hideOnMobile/hideOnDesktop. Form a list of classes to be joined when the item is rendered #}
                            {% set hideClasses = [] %}
                            {% if entry.hideOnMobile %}
                                {% set hideClasses = (hideClasses.push("hide-on-mobile"), hideClasses) %}
                            {% endif %}
                            {% if entry.hideOnDesktop %}
                                {% set hideClasses = (hideClasses.push("hide-on-desktop"), hideClasses) %}
                            {% endif %}

                            {# If this page is a dropdown, give it the appropriate classes, icons and accessibility attributes #}
                            <li
                                class="menu-item {% if hasChild %}menu-item-dropdown{% endif %} {{ hideClasses | join(" ") }}"
                            >
                                {# If the page has child dropdown pages, render it as a <button> tag with the appropriate dropdown HTML #}
                                {% if hasChild %}

                                    {# Check to see if the user's current page is one of the child pages. If so, apply the cs-active class to the dropdown parent #}
                                    {% set activeClass = "" %}
                                    {% for child in entry.children %}
                                        {% if child.url == page.url %}
                                            {% set activeClass = " active" %}
                                        {% endif %}
                                        {% if isActive %}
                                            {% set activeClass = "active" %}
                                        {% endif %}
                                    {% endfor %}

                                    {# Render the <button> with the active class, dropdown icon and child links #}
                                    <button class="menu-link dropdown-toggle{{ activeClass }}" aria-expanded="false" aria-haspopup="menu" id="{{ entry.key }}-dropdown-toggle" >
                                        
                                        <a href="{{ entry.url }}" class="menu-link{{ activeClass }}">{{ entry.key }}
                                            <img class="dropdown-icon" src="/assets/images/chevron-dropdown.svg" alt="dropdown icon" width="15" height="15" decoding="async" aria-hidden="true" />
                                        </a>
                                    </button>

                                    {# Dropdowns have another ul/li set up within the parent li, which gets rendered in the same way as a normal link #}
                                    <ul class="dropdown-ul" aria-labelledby="dropdown-{{ entry.key }}">
                                        {% for child in entry.children %}
                                            <li class="dropdown-li">
                                                <a href="{{ child.url }}" class="menu-link dropdown-link {% if child.url == page.url %}active{% endif %}" aria-label="{{ child.key }}">
                                                    {{ child.key }}
                                                </a>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    {# Normal pages are rendered as <a> tags, in the normal way you'd expect #}
                                    <a href="{{ entry.url }}" class="menu-link {% if isActive %}active{% endif %}" {% if entry.url == page.url %}aria-current="page"{% endif %}>
                                        {{ entry.key }}
                                    </a>
                                {% endif %}
                            </li>
                            {% endfor %}
                    </ul>
                </div>
            </nav>
            <div class="brand">
                <a href="/" class="logo">
                    <img src="{{ logo }}" alt="{{ logo_alt }}">
                </a>
            </div>
    </div>
    </div>
    
</header>

